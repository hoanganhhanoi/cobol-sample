001360*>
001370 IDENTIFICATION DIVISION.
001380 PROGRAM-ID.   DEMO.
001390 ENVIRONMENT    DIVISION.
001400 CONFIGURATION  SECTION.
001410 INPUT-OUTPUT SECTION.
001420 FILE-CONTROL.
001430 		SELECT PRODUCT ASSIGN TO FILE01 
001431 			ORGANIZATION LINE SEQUENTIAL.
001432 		
001433 		SELECT SORTED-FILE-PRODUCT ASSIGN TO FILE02
001435			ORGANIZATION IS LINE SEQUENTIAL.
001436			
001437		SELECT WORK ASSIGN TO WORK01.
001438		
001439		SELECT FILE-OUT ASSIGN TO PRINTER.
001441		
001442 DATA DIVISION.
001450 FILE SECTION.
001460 FD PRODUCT.
001470 01 PRODUCT-DETAILS.
001480 	02 PRODUCT-ID-I					PIC X(4).
001490 	02 PRODUCT-NAME-I				PIC X(20).
001500 	02 PRICE-I						PIC 9(4).
001510 	02 QUANTITY-I					PIC 9(3).
001511 		
001520 FD SORTED-FILE-PRODUCT.
001521 01 PRODUCT-DETAILS.
001523 	02 PRODUCT-ID					PIC X(4).
001524 	02 PRODUCT-NAME					PIC X(20).
001525 	02 PRICE						PIC 9(4).
001526 	02 QUANTITY						PIC 9(3).
001527 		
001528 SD WORK.
001529 01 WORK-PRODUCT.
001530  02 PRODUCT-ID-WF				PIC X(4).
001531 	02 PRODUCT-NAME-WF				PIC X(20).
001532 	02 PRODUCT-PRICE-WF		    	PIC 9(4).
001533 	02 PRODUCT-QUANTITY-WF			PIC 9(3).
001534 
001535 FD FILE-OUT.
001536 01 LINE-RECORD					PIC X(75).
001537 
001540 WORKING-STORAGE SECTION.
001550 01 REPORT-HEADING.
001551  02 FILLER 	PIC X(15)		VALUE SPACES.
001552 	02 FILLER 	PIC X(88)
001553 		VALUE "        ****** REPORT FOR THE SHOP ******       ".
001554 		
001555 01 REPORT-COLUMN-HEADING.
001556 	02 FILLER				PIC X(9)	VALUE SPACES.
001557 	02 FILLER				PIC X(4) 	VALUE "CODE".
001558 	02 FILLER				PIC X(7) 	VALUE SPACES.
001559 	02 FILLER				PIC X(14) 	VALUE "PRODUCT NAME".
001560 	02 FILLER				PIC X(10) 	VALUE SPACES.
001561 	02 FILLER			 	PIC X(5)  	VALUE "PRICE".
001562 	02 FILLER				PIC X(4) 	VALUE SPACES.
001563 	02 FILLER				PIC X(8)  	VALUE "QUANTITY".
001564 	02 FILLER				PIC X(8)	VALUES SPACES.
001565 	02 FILLER				PIC X(49) 	VALUE "TOTAL".
001566 	
001567 01 REPORT-FOOTING.
001568  02 FILLER				PIC X(15)		VALUE SPACES. 
001569 	02 FILLER PIC X(88) 
001570 		VALUE "        ******    END OF REPORT    ******        ".
001571  		
001572 01 PRINT-PRODUCT-VALUE.
001573 	02 FILLER				PIC X(9)		VALUE SPACES.
001574 	02 PR-PRODUCT-ID		PIC X(4).
001575 	02 FILLER				PIC X(5) 		VALUE SPACES.
001576 	02 PR-PRODUCT-NAME		PIC X(20).
001577 	02 FILLER				PIC X(5) 		VALUE SPACES.
001578 	02 PR-PRODUCT-PRICE 	PIC z,zz9 		BLANK WHEN ZERO.
001579 	02 FILLER				PIC X(5) 		VALUE SPACES.
001580 	02 PR-PRODUCT-QUANTITY	PIC zz9 		BLANK WHEN ZERO.
001581 	02 FILLER				PIC X(10) 		VALUES SPACES.
001582 	02 PR-PRODUCT-VALUE		PIC z,zzz,zz9 	BLANK WHEN ZERO.
001583 		
001584 01 ERROR-MESSAGE.
001585 	02 READ-ERROR PIC X(46).			
001586 	  88 MESSAGE-ERROR VALUE "READ ERROR - CAN'T READ A FILE DATA".
001587 	02 NOT-VALID-NUMBER.	    
001588 	  05 PRICE-ERROR 		PIC X(4) VALUE "----".
001589 	  05 QUANTITY-ERROR 	PIC X(3) VALUE "---".	
001590 		
001591 01 PR-ERROR.
001592  02 FILLER					PIC X(9) VALUE SPACES.
001593 	02 PR-PRODUCT-ID-ERROR		PIC X(4).
001594 	02 FILLER					PIC X(5) VALUE SPACES.
001595 	02 PR-PRODUCT-NAME-ERROR	PIC X(20).
001596 	02 FILLER					PIC X(6) VALUE SPACES.
001597 	02 PR-PRICE-ERROR			PIC	X(4).
001598 	02 FILLER					PIC X(5) VALUE SPACES.
001599 	02 PR-QUANTITY-ERROR		PIC X(3).
001600 	02 FILLER					PIC X(12) VALUE SPACES.
001601 	02 PR-VALUE-ERROR			PIC X(7) VALUE "-------".
001602 
001603 01 PRINT-PRICE-TOTAL.
001604 	02 FILLER			PIC X(57) 	VALUE SPACES.
001605 	02 FILLER			PIC X(8) 	VALUE "TOTAL: ".
001606 	02 PRINT-TOTAL		PIC zz,zzz,zz9 BLANK WHEN ZERO.
001607 
001608 01 PRINT-GROUP-LINE.
001609 	02 FILLER			PIC X(44)	VALUE SPACES.
001610 	02 FILLER			PIC X(6) 	VALUE "GROUP ".
001611 	02 PR-GROUP-ID		PIC X.
001612 	02 FILLER			PIC X(4)    VALUE "XXX".
001613 	02 FILLER			PIC X(9) 	VALUE "TOTAL : ".
001614 	02 PR-GROUP-TOTAL	PIC zzz,zzz,zz9 BLANK WHEN ZERO.
001615 
001616 01 PRINT-INFO-RECORD-ERROR.
001617  02 FILLER			PIC X(9)	VALUE SPACES.
001618 	02 FILLER			PIC X(22)	VALUE "TOTAL RECORDS ERROR : ".
001619 	02 PR-COUNT-RECORD-ERROR  PIC zz,zz9 BLANK WHEN ZERO.
001620 
001621 01 PRINT-INFO-RECORD-NORMAL.
001622 	02 FILLER			PIC X(9)   	VALUE SPACES.
001623 	02 FILLER			PIC X(23)   VALUE "TOTAL RECORDS NORMAL : ".
001625 	02 PR-COUNT-RECORD-NORMAL  PIC zz,zz9 BLANK WHEN ZERO.
001626 	
001627 01 PRINT-INFO-RECORD.
001628  02 FILLER				PIC X(9)	VALUE SPACES.
001629 	02 FILLER				PIC X(16)	VALUE "TOTAL RECORDS : ".
001630 	02 PR-COUNTER 			PIC zz,zz9 BLANK WHEN ZEROS.
001631 
001632 01 GROUP-PRODUCT.
001633 	02 GROUP-ID			PIC 9.
001634 	02 PREV-GROUP-ID	PIC 9		VALUE ZERO.
001635 	02 GROUP-TOTAL		PIC 9(9)	VALUE ZEROS.
001636 		
001637 01 EOF-FILE				PIC X 		VALUE "N".
001638 01 CHECK-PRICE			PIC 9 		VALUE ZERO.
001639 01 CHECK-QUANTITY		PIC 9 		VALUE ZERO.
001646 01 CHECK-ERROR			PIC 9 		VALUE ZERO.
001680 01 DELAY					PIC 9 		VALUE ZERO.
001721 01 PRODUCT-VALUE			PIC 9(8) 	VALUE ZERO.
001730 01 COUNT-RECORD-ERROR	PIC 9(8) 	VALUE ZERO.
001740 01 COUNTER 				PIC 9(8) 	VALUE ZERO.
001742 01 PRICE-TOTAL			PIC 9(8) 	VALUE ZERO.
001750 01 PAGE-LINES-WRITTEN    PIC 9(2)    VALUE ZEROS.
001760 01 PAGE-NUMBER			PIC 9(8)	VALUE ZEROS.
001770 
001790 PROCEDURE DIVISION.
001800 MAIN.
001801 		PERFORM SORT-FILE
001820 		PERFORM INITIALIZATION
001830 		PERFORM MAIN-PROCESS UNTIL EOF-FILE = "Y"
001831 		PERFORM WRAP-UP
001880 		STOP RUN.
001881
001882* INITIALIZATION  		
001890 INITIALIZATION.
001900* OPEN FILE SORT DATA AND FILE OUTPUT   		
001901 		OPEN INPUT SORTED-FILE-PRODUCT
001902 		OPEN OUTPUT FILE-OUT
001903 		
001910 		READ SORTED-FILE-PRODUCT
001920 			AT END
001930 				MOVE "Y" TO EOF-FILE
001940 			NOT AT END
001950 				ADD 1 TO COUNTER
001951 				ADD 1 TO PAGE-LINES-WRITTEN
001960 		END-READ
001961 		
001962* DISPLAY TO CONSOLE AND WRITE HEADING TO FILE  		
001963 		DISPLAY REPORT-HEADING
001964 		DISPLAY REPORT-COLUMN-HEADING
001965 		
001966 		WRITE LINE-RECORD FROM REPORT-HEADING
001967 		WRITE LINE-RECORD FROM REPORT-COLUMN-HEADING 
001968 			AFTER ADVANCING 2 LINES.
001969 		
001970* SORT FILE BY PRODUCT ID
001971 SORT-FILE.
001972 		SORT WORK ON ASCENDING KEY PRODUCT-ID-WF
001973   	USING PRODUCT GIVING SORTED-FILE-PRODUCT.
001974
001975* PROCESS HANDLING DATA IN FILE    	 
001976 MAIN-PROCESS.
001980 	   COMPUTE GROUP-ID = FUNCTION  NUMVAL(PRODUCT-ID(1:1))
001990 		
002000 	   IF PREV-GROUP-ID = ZERO
002010 	   		COMPUTE PREV-GROUP-ID = FUNCTION NUMVAL(PRODUCT-ID(1:1))
002020 	   END-IF
002030 		
002040 	   PERFORM UNTIL EOF-FILE = "Y"
002050 			COMPUTE PREV-GROUP-ID = FUNCTION NUMVAL(PRODUCT-ID(1:1))
002060	 		IF PREV-GROUP-ID NOT = GROUP-ID
002070	 			THEN EXIT PERFORM
002080	 		ELSE
002090	 			IF QUANTITY IS NOT NUMERIC 
002100	 				MOVE QUANTITY-ERROR TO PR-QUANTITY-ERROR
002110	 				MOVE 1 TO CHECK-ERROR
002120	 				MOVE 1 TO CHECK-QUANTITY
002130	 			ELSE
002131	 				MOVE QUANTITY TO PR-PRODUCT-QUANTITY
002132	 				MOVE PR-PRODUCT-QUANTITY TO PR-QUANTITY-ERROR
002133	 			END-IF
002134	 			
002140	 			IF PRICE IS NOT NUMERIC
002150	 				MOVE PRICE-ERROR TO PR-PRICE-ERROR
002160	 				MOVE 1 TO CHECK-ERROR
002170	 				MOVE 1 TO CHECK-PRICE
002180	 			ELSE
002181	 				MOVE PRICE TO PR-PRODUCT-PRICE
002182	 				MOVE PR-PRODUCT-PRICE TO PR-PRICE-ERROR
002183	 			END-IF
002190	 			
002200	 			IF CHECK-QUANTITY = 1 OR CHECK-PRICE = 1
002210	 				MOVE 0 TO CHECK-QUANTITY
002220	 				MOVE 0 TO CHECK-PRICE
002230	 				ADD  1 TO COUNT-RECORD-ERROR	
002240	 			END-IF
002250	 			
002260	 			IF CHECK-ERROR = 1
002270	 				MOVE PRODUCT-ID 		TO PR-PRODUCT-ID-ERROR
002271				 	MOVE PRODUCT-NAME		TO PR-PRODUCT-NAME-ERROR
002280					PERFORM PRINT-ERROR
002340	 				MOVE 0 TO CHECK-ERROR 
002350	 			ELSE
002360		 			COMPUTE PRODUCT-VALUE = QUANTITY * PRICE
002370		 			ADD PRODUCT-VALUE TO GROUP-TOTAL 
002381		 			
002390		 			MOVE PRODUCT-ID 		TO PR-PRODUCT-ID
002391				 	MOVE PRODUCT-NAME		TO PR-PRODUCT-NAME
002392				 	MOVE PRICE				TO PR-PRODUCT-PRICE
002393				 	MOVE QUANTITY			TO PR-PRODUCT-QUANTITY
002394				 	MOVE PRODUCT-VALUE		TO PR-PRODUCT-VALUE
002400		 			PERFORM PRINT-PRODUCT
002460		 		END-IF
002470	 		END-IF
002480	 	END-PERFORM
002490 		
002491 		PERFORM PRINT-GROUP-TOTAL
002492 		ADD GROUP-TOTAL TO PRICE-TOTAL
002500 		MOVE 0 TO GROUP-TOTAL.
002501 		
002510 WRAP-UP.
002520 		PERFORM PRINT-TOTAL-PRICE
002530 		
002531 		COMPUTE PR-COUNT-RECORD-NORMAL = COUNTER - 
002532 											COUNT-RECORD-ERROR
002533 		
002540 		MOVE COUNT-RECORD-ERROR TO PR-COUNT-RECORD-ERROR
002550 		MOVE COUNTER TO PR-COUNTER
002551 		
002552 		DISPLAY PRINT-INFO-RECORD
002560 		DISPLAY PRINT-INFO-RECORD-ERROR
002561 		DISPLAY PRINT-INFO-RECORD-NORMAL
002570 		
002581 		WRITE LINE-RECORD FROM PRINT-INFO-RECORD
002582 			AFTER ADVANCING 2 LINES
002590 		WRITE LINE-RECORD FROM PRINT-INFO-RECORD-ERROR
002591 		WRITE LINE-RECORD FROM PRINT-INFO-RECORD-NORMAL
002601 			
002611 		DISPLAY REPORT-FOOTING
002612 		WRITE LINE-RECORD FROM REPORT-FOOTING
002613 			AFTER ADVANCING 2 LINES
002614 		
002615 		CLOSE SORTED-FILE-PRODUCT
002616 		CLOSE FILE-OUT
002617 		ACCEPT DELAY.
002618
002619* WRITE PRODUCT DETAIL TO FILE AND DISPLAY TO CONSOLE 			
002620 PRINT-PRODUCT.
002621 		DISPLAY PRINT-PRODUCT-VALUE
002622 		IF PAGE-LINES-WRITTEN > 20
002623 			WRITE LINE-RECORD FROM PRINT-PRODUCT-VALUE 
002624 				AFTER ADVANCING PAGE
002625 			MOVE 0 TO PAGE-LINES-WRITTEN
002626 			ADD 1 TO PAGE-NUMBER
002627 		ELSE
002628 			WRITE LINE-RECORD FROM PRINT-PRODUCT-VALUE
002629 		END-IF
002630 		
002631 		READ SORTED-FILE-PRODUCT
002632		 	AT END
002633		 		MOVE "Y" TO EOF-FILE
002634		 	NOT AT END
002635		 		ADD 1 TO COUNTER
002636		 		ADD 1 TO PAGE-LINES-WRITTEN
002637		END-READ.
002638
002639* WRITE RECORD ERROR TO FILE AND DISPLAY TO CONSOLE		
002640 PRINT-ERROR.
002641 		DISPLAY PR-ERROR
002642 		IF PAGE-LINES-WRITTEN > 20
002643 			WRITE LINE-RECORD FROM PR-ERROR
002644 				AFTER ADVANCING PAGE
002645 			MOVE 0 TO PAGE-LINES-WRITTEN
002646 			ADD 1 TO PAGE-NUMBER
002647 		ELSE
002648 			WRITE LINE-RECORD FROM PR-ERROR
002649 		END-IF
002650 		
002651 		READ SORTED-FILE-PRODUCT
002652		 	AT END
002653		 		MOVE "Y" TO EOF-FILE
002654		 	NOT AT END
002655		 		ADD 1 TO COUNTER
002656		 		ADD 1 TO PAGE-LINES-WRITTEN
002657		END-READ.
002658
002659* WRITE GROUP TOTAL TO FILE AND DISPLAY TO CONSOLE 		
002660 PRINT-GROUP-TOTAL.
002661 		MOVE GROUP-ID 			TO PR-GROUP-ID
002662		MOVE GROUP-TOTAL		TO PR-GROUP-TOTAL
002664		DISPLAY PRINT-GROUP-LINE
002665		DISPLAY SPACES
002666		
002667		WRITE LINE-RECORD FROM PRINT-GROUP-LINE.
002668		MOVE SPACES TO LINE-RECORD
002669		WRITE LINE-RECORD.
002670
002671* WRITE TOTAL PRICE TO FILE AND DISPLAY TO CONSOLE
002672 PRINT-TOTAL-PRICE.
002673 		MOVE PRICE-TOTAL TO PRINT-TOTAL
002674 		DISPLAY PRINT-PRICE-TOTAL
002675 		WRITE LINE-RECORD FROM PRINT-PRICE-TOTAL.
002676		
002677 END PROGRAM DEMO.
002680